"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateBaseTransform = calculateBaseTransform;
exports.getBoundingBox = getBoundingBox;
exports.getLeafNodes = getLeafNodes;
exports.getBaselineHeight = getBaselineHeight;
exports.encodeLineCap = encodeLineCap;
exports.encodeLineJoin = encodeLineJoin;

function calculateBaseTransform(dom, root) {
  // https://github.com/dagrejs/dagre-d3/issues/202
  return root.getScreenCTM().inverse().multiply(dom.getScreenCTM());
}

function getBoundingBox(dom) {
  var svgRoot = dom;

  while (true) {
    if (svgRoot.parentElement instanceof SVGGraphicsElement) {
      svgRoot = svgRoot.parentElement;
    } else {
      break;
    }
  }

  var baseBox = calculateBaseTransform(dom, svgRoot);
  var refBBox = dom.getBBox();
  var coordinate = [baseBox.e + refBBox.x, baseBox.f + refBBox.y, refBBox.width + 1, refBBox.height + 1];
  return coordinate;
}

function getLeafNodes(master) {
  // https://stackoverflow.com/questions/22289391/how-to-create-an-array-of-leaf-nodes-of-an-html-dom-using-javascript
  var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
  var leafNodes = nodes.filter(function (elem) {
    if (elem.hasChildNodes()) {
      // see if any of the child nodes are elements
      for (var i = 0; i < elem.childNodes.length; i++) {
        if (elem.childNodes[i].nodeType == 1) {
          // there is a child element, so return false to not include
          // this parent element
          return false;
        }
      }
    }

    return true;
  });
  return leafNodes;
}

function getBaselineHeight(dom) {
  var canvas = document.createElement('canvas');
  var ctx = canvas.getContext('2d');
  var computedStyle = getComputedStyle(dom);
  var fontSettings = computedStyle.font;
  ctx.font = fontSettings;
  var textMetrix = ctx.measureText('ypfgjâ–ˆ');
  return textMetrix.actualBoundingBoxDescent || 0;
}

function encodeLineCap(type) {
  switch (type) {
    case 'square':
      return 3;

    case 'butt':
      return 1;

    default:
      return 2;
  }
}

function encodeLineJoin(type) {
  switch (type) {
    case 'miter':
      return 1;

    case 'bevel':
      return 3;

    default:
      return 2;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9oZWxwZXIudHMiXSwibmFtZXMiOlsiY2FsY3VsYXRlQmFzZVRyYW5zZm9ybSIsImRvbSIsInJvb3QiLCJnZXRTY3JlZW5DVE0iLCJpbnZlcnNlIiwibXVsdGlwbHkiLCJnZXRCb3VuZGluZ0JveCIsInN2Z1Jvb3QiLCJwYXJlbnRFbGVtZW50IiwiU1ZHR3JhcGhpY3NFbGVtZW50IiwiYmFzZUJveCIsInJlZkJCb3giLCJnZXRCQm94IiwiY29vcmRpbmF0ZSIsImUiLCJ4IiwiZiIsInkiLCJ3aWR0aCIsImhlaWdodCIsImdldExlYWZOb2RlcyIsIm1hc3RlciIsIm5vZGVzIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImxlYWZOb2RlcyIsImZpbHRlciIsImVsZW0iLCJoYXNDaGlsZE5vZGVzIiwiaSIsImNoaWxkTm9kZXMiLCJsZW5ndGgiLCJub2RlVHlwZSIsImdldEJhc2VsaW5lSGVpZ2h0IiwiY2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY3R4IiwiZ2V0Q29udGV4dCIsImNvbXB1dGVkU3R5bGUiLCJnZXRDb21wdXRlZFN0eWxlIiwiZm9udFNldHRpbmdzIiwiZm9udCIsInRleHRNZXRyaXgiLCJtZWFzdXJlVGV4dCIsImFjdHVhbEJvdW5kaW5nQm94RGVzY2VudCIsImVuY29kZUxpbmVDYXAiLCJ0eXBlIiwiZW5jb2RlTGluZUpvaW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFPLFNBQVNBLHNCQUFULENBQWdDQyxHQUFoQyxFQUF5REMsSUFBekQsRUFBbUY7QUFDdEY7QUFFQSxTQUFPQSxJQUFJLENBQUNDLFlBQUwsR0FBcUJDLE9BQXJCLEdBQStCQyxRQUEvQixDQUF3Q0osR0FBRyxDQUFDRSxZQUFKLEVBQXhDLENBQVA7QUFDSDs7QUFFTSxTQUFTRyxjQUFULENBQXdCTCxHQUF4QixFQUFpRDtBQUNwRCxNQUFJTSxPQUEyQixHQUFHTixHQUFsQzs7QUFDQSxTQUFPLElBQVAsRUFBYTtBQUNULFFBQUlNLE9BQU8sQ0FBQ0MsYUFBUixZQUFpQ0Msa0JBQXJDLEVBQXlEO0FBQ3JERixNQUFBQSxPQUFPLEdBQUdBLE9BQU8sQ0FBQ0MsYUFBbEI7QUFDSCxLQUZELE1BRU87QUFDSDtBQUNIO0FBQ0o7O0FBQ0QsTUFBTUUsT0FBTyxHQUFHVixzQkFBc0IsQ0FBQ0MsR0FBRCxFQUFNTSxPQUFOLENBQXRDO0FBQ0EsTUFBTUksT0FBTyxHQUFHVixHQUFHLENBQUNXLE9BQUosRUFBaEI7QUFDQSxNQUFNQyxVQUE0QyxHQUFHLENBQUNILE9BQU8sQ0FBQ0ksQ0FBUixHQUFZSCxPQUFPLENBQUNJLENBQXJCLEVBQXdCTCxPQUFPLENBQUNNLENBQVIsR0FBWUwsT0FBTyxDQUFDTSxDQUE1QyxFQUErQ04sT0FBTyxDQUFDTyxLQUFSLEdBQWdCLENBQS9ELEVBQWtFUCxPQUFPLENBQUNRLE1BQVIsR0FBaUIsQ0FBbkYsQ0FBckQ7QUFDQSxTQUFPTixVQUFQO0FBQ0g7O0FBRU0sU0FBU08sWUFBVCxDQUFzQkMsTUFBdEIsRUFBd0U7QUFDM0U7QUFFQSxNQUFJQyxLQUFLLEdBQUdDLEtBQUssQ0FBQ0MsU0FBTixDQUFnQkMsS0FBaEIsQ0FBc0JDLElBQXRCLENBQTJCTCxNQUFNLENBQUNNLG9CQUFQLENBQTRCLEdBQTVCLENBQTNCLEVBQTZELENBQTdELENBQVo7QUFDQSxNQUFJQyxTQUFTLEdBQUdOLEtBQUssQ0FBQ08sTUFBTixDQUFhLFVBQVVDLElBQVYsRUFBZ0I7QUFDekMsUUFBSUEsSUFBSSxDQUFDQyxhQUFMLEVBQUosRUFBMEI7QUFDdEI7QUFDQSxXQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLElBQUksQ0FBQ0csVUFBTCxDQUFnQkMsTUFBcEMsRUFBNENGLENBQUMsRUFBN0MsRUFBaUQ7QUFDN0MsWUFBSUYsSUFBSSxDQUFDRyxVQUFMLENBQWdCRCxDQUFoQixFQUFtQkcsUUFBbkIsSUFBK0IsQ0FBbkMsRUFBc0M7QUFDbEM7QUFDQTtBQUNBLGlCQUFPLEtBQVA7QUFDSDtBQUNKO0FBQ0o7O0FBQ0QsV0FBTyxJQUFQO0FBQ0gsR0FaZSxDQUFoQjtBQWFBLFNBQU9QLFNBQVA7QUFDSDs7QUFFTSxTQUFTUSxpQkFBVCxDQUEyQm5DLEdBQTNCLEVBQWdEO0FBQ25ELE1BQU1vQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixRQUF2QixDQUFmO0FBQ0EsTUFBTUMsR0FBRyxHQUFHSCxNQUFNLENBQUNJLFVBQVAsQ0FBa0IsSUFBbEIsQ0FBWjtBQUNBLE1BQU1DLGFBQWEsR0FBR0MsZ0JBQWdCLENBQUMxQyxHQUFELENBQXRDO0FBQ0EsTUFBTTJDLFlBQVksR0FBR0YsYUFBYSxDQUFDRyxJQUFuQztBQUVBTCxFQUFBQSxHQUFHLENBQUNLLElBQUosR0FBV0QsWUFBWDtBQUNBLE1BQU1FLFVBQVUsR0FBR04sR0FBRyxDQUFDTyxXQUFKLENBQWdCLFFBQWhCLENBQW5CO0FBQ0EsU0FBT0QsVUFBVSxDQUFDRSx3QkFBWCxJQUF1QyxDQUE5QztBQUNIOztBQUVNLFNBQVNDLGFBQVQsQ0FBdUJDLElBQXZCLEVBQXFEO0FBQ3hELFVBQVFBLElBQVI7QUFDSSxTQUFLLFFBQUw7QUFDSSxhQUFPLENBQVA7O0FBQ0osU0FBSyxNQUFMO0FBQ0ksYUFBTyxDQUFQOztBQUNKO0FBQ0ksYUFBTyxDQUFQO0FBTlI7QUFRSDs7QUFFTSxTQUFTQyxjQUFULENBQXdCRCxJQUF4QixFQUFzRDtBQUN6RCxVQUFRQSxJQUFSO0FBQ0ksU0FBSyxPQUFMO0FBQ0ksYUFBTyxDQUFQOztBQUNKLFNBQUssT0FBTDtBQUNJLGFBQU8sQ0FBUDs7QUFDSjtBQUNJLGFBQU8sQ0FBUDtBQU5SO0FBUUgiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQmFzZVRyYW5zZm9ybShkb206IFNWR0dyYXBoaWNzRWxlbWVudCwgcm9vdDogU1ZHR3JhcGhpY3NFbGVtZW50KSB7XHJcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZGFncmVqcy9kYWdyZS1kMy9pc3N1ZXMvMjAyXHJcblxyXG4gICAgcmV0dXJuIHJvb3QuZ2V0U2NyZWVuQ1RNKCkhLmludmVyc2UoKS5tdWx0aXBseShkb20uZ2V0U2NyZWVuQ1RNKCkhKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Qm91bmRpbmdCb3goZG9tOiBTVkdHcmFwaGljc0VsZW1lbnQpIHtcclxuICAgIGxldCBzdmdSb290OiBTVkdHcmFwaGljc0VsZW1lbnQgPSBkb21cclxuICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgaWYgKHN2Z1Jvb3QucGFyZW50RWxlbWVudCBpbnN0YW5jZW9mIFNWR0dyYXBoaWNzRWxlbWVudCkge1xyXG4gICAgICAgICAgICBzdmdSb290ID0gc3ZnUm9vdC5wYXJlbnRFbGVtZW50XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBiYXNlQm94ID0gY2FsY3VsYXRlQmFzZVRyYW5zZm9ybShkb20sIHN2Z1Jvb3QpXHJcbiAgICBjb25zdCByZWZCQm94ID0gZG9tLmdldEJCb3goKVxyXG4gICAgY29uc3QgY29vcmRpbmF0ZTogW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPSBbYmFzZUJveC5lICsgcmVmQkJveC54LCBiYXNlQm94LmYgKyByZWZCQm94LnksIHJlZkJCb3gud2lkdGggKyAxLCByZWZCQm94LmhlaWdodCArIDFdXHJcbiAgICByZXR1cm4gY29vcmRpbmF0ZVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGVhZk5vZGVzKG1hc3RlcjogU1ZHR3JhcGhpY3NFbGVtZW50KTogU1ZHR3JhcGhpY3NFbGVtZW50W10ge1xyXG4gICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjIyODkzOTEvaG93LXRvLWNyZWF0ZS1hbi1hcnJheS1vZi1sZWFmLW5vZGVzLW9mLWFuLWh0bWwtZG9tLXVzaW5nLWphdmFzY3JpcHRcclxuXHJcbiAgICB2YXIgbm9kZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChtYXN0ZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpLCAwKTtcclxuICAgIHZhciBsZWFmTm9kZXMgPSBub2Rlcy5maWx0ZXIoZnVuY3Rpb24gKGVsZW0pIHtcclxuICAgICAgICBpZiAoZWxlbS5oYXNDaGlsZE5vZGVzKCkpIHtcclxuICAgICAgICAgICAgLy8gc2VlIGlmIGFueSBvZiB0aGUgY2hpbGQgbm9kZXMgYXJlIGVsZW1lbnRzXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbS5jaGlsZE5vZGVzW2ldLm5vZGVUeXBlID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGVyZSBpcyBhIGNoaWxkIGVsZW1lbnQsIHNvIHJldHVybiBmYWxzZSB0byBub3QgaW5jbHVkZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgcGFyZW50IGVsZW1lbnRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBsZWFmTm9kZXM7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRCYXNlbGluZUhlaWdodChkb206IFNWR1RleHRFbGVtZW50KSB7XHJcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxyXG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykhXHJcbiAgICBjb25zdCBjb21wdXRlZFN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShkb20pXHJcbiAgICBjb25zdCBmb250U2V0dGluZ3MgPSBjb21wdXRlZFN0eWxlLmZvbnRcclxuXHJcbiAgICBjdHguZm9udCA9IGZvbnRTZXR0aW5nc1xyXG4gICAgY29uc3QgdGV4dE1ldHJpeCA9IGN0eC5tZWFzdXJlVGV4dCgneXBmZ2rilognKVxyXG4gICAgcmV0dXJuIHRleHRNZXRyaXguYWN0dWFsQm91bmRpbmdCb3hEZXNjZW50IHx8IDBcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGVuY29kZUxpbmVDYXAodHlwZT86IHN0cmluZyB8IG51bGwpOiBudW1iZXIge1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnc3F1YXJlJzpcclxuICAgICAgICAgICAgcmV0dXJuIDNcclxuICAgICAgICBjYXNlICdidXR0JzpcclxuICAgICAgICAgICAgcmV0dXJuIDFcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gMlxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5jb2RlTGluZUpvaW4odHlwZT86IHN0cmluZyB8IG51bGwpOiBudW1iZXIge1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnbWl0ZXInOlxyXG4gICAgICAgICAgICByZXR1cm4gMVxyXG4gICAgICAgIGNhc2UgJ2JldmVsJzpcclxuICAgICAgICAgICAgcmV0dXJuIDNcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gMlxyXG4gICAgfVxyXG59Il19