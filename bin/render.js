"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.render = render;
exports.renderPlainGlyph = renderPlainGlyph;
exports.renderText = renderText;
exports.renderImage = renderImage;

var _path = require("./path");

var _v = _interopRequireDefault(require("uuid/v4"));

var _svgPathParser = require("svg-path-parser");

var _helper = require("./helper");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === "[object Arguments]")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function render(dom, baseDom) {
  if (dom instanceof SVGTextElement || dom instanceof SVGImageElement) {
    return [];
  } else if (dom instanceof SVGGElement) {
    return renderGroup(dom, baseDom);
  } else {
    return renderGlyph(dom, baseDom);
  }
}

function encodeLineCap(type) {
  switch (type) {
    case 'square':
      return 3;

    case 'butt':
      return 1;

    default:
      return 2;
  }
}

function encodeLineJoin(type) {
  switch (type) {
    case 'miter':
      return 1;

    case 'bevel':
      return 3;

    default:
      return 2;
  }
}

function addVisualEncodings(items, styles, dom, baseDom) {
  if (styles.stroke && styles.stroke !== 'none') {
    items.push({
      ty: 'st',
      c: {
        k: styles.stroke.split('(')[1].split(')')[0].split(',').slice(0, 3).map(function (raw) {
          return parseInt(raw) / 255;
        }).concat(1)
      },
      o: {
        k: parseFloat(styles.strokeOpacity || '1') * 100
      },
      w: {
        k: parseFloat(styles.strokeWidth || '1')
      },
      lc: encodeLineCap(styles.strokeLinecap),
      lj: encodeLineJoin(styles.strokeLinejoin)
    });
  }

  if (styles.fill && styles.fill !== 'none') {
    items.push({
      ty: 'fl',
      c: {
        k: styles.fill.split('(')[1].split(')')[0].split(',').slice(0, 3).map(function (raw) {
          return parseInt(raw) / 255;
        }).concat(1)
      },
      o: {
        k: parseFloat(styles.fillOpacity || '1') * 100
      }
    });
  }

  var posX = 0,
      posY = 0;

  if (dom && baseDom) {
    var baseTransform = (0, _helper.calculateBaseTransform)(dom, baseDom);
    var baseBBox = baseDom.getBBox();
    var refBBox = dom.getBBox();
    posX = baseTransform.e + refBBox.x - baseBBox.x;
    posY = baseTransform.f + refBBox.y - baseBBox.y;
  }

  items.push({
    ty: "tr",
    p: {
      k: [posX, posY]
    },
    a: {
      k: [0, 0]
    },
    s: {
      k: [100, 100]
    },
    r: {
      k: 0
    },
    o: {
      k: parseFloat(styles.opacity || '1') * 100
    },
    sk: {
      k: 0
    },
    sa: {
      k: 0
    }
  });
}

function renderGlyph(dom, baseDom) {
  var group = {
    ty: "gr",
    it: [],
    bm: 0,
    hd: false
  };

  var postActions = function postActions(pathMaker) {
    pathMaker.uniform();
    group.it.push({
      ty: 'sh',
      ks: {
        k: pathMaker.path,
        a: 0
      },
      nm: dom.id,
      hd: false
    });
    var styles = window.getComputedStyle(dom);
    addVisualEncodings(group.it, styles, dom, baseDom);
  };

  if (dom instanceof SVGCircleElement) {
    var svgLength = dom.r.baseVal;
    svgLength.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX);
    var r = svgLength.valueInSpecifiedUnits;
    var pathMaker = new _path.PathMaker();
    pathMaker.moveTo(r, 0);
    pathMaker.arcTo(r, r, 0, 1, 0, r, 2 * r);
    pathMaker.arcTo(r, r, 0, 1, 0, r, 0);
    pathMaker.closePath();
    postActions(pathMaker);
  } else if (dom instanceof SVGEllipseElement) {
    var mapKey = ['rx', 'ry'];

    var _mapKey$map = mapKey.map(function (key) {
      var svgLength = dom[key].baseVal;
      svgLength.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX);
      return svgLength.valueInSpecifiedUnits;
    }),
        _mapKey$map2 = _slicedToArray(_mapKey$map, 2),
        rx = _mapKey$map2[0],
        ry = _mapKey$map2[1];

    var _pathMaker = new _path.PathMaker();

    _pathMaker.moveTo(rx, 0);

    _pathMaker.arcTo(rx, ry, 0, 1, 0, rx, 2 * ry);

    _pathMaker.arcTo(rx, ry, 0, 1, 0, rx, 0);

    _pathMaker.closePath();

    postActions(_pathMaker);
  } else if (dom instanceof SVGLineElement) {
    var _mapKey = ['x1', 'x2', 'y1', 'y2'];

    var _mapKey$map3 = _mapKey.map(function (key) {
      var svgLength = dom[key].baseVal;
      svgLength.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX);
      return svgLength.valueInSpecifiedUnits;
    }),
        _mapKey$map4 = _slicedToArray(_mapKey$map3, 4),
        x1 = _mapKey$map4[0],
        x2 = _mapKey$map4[1],
        y1 = _mapKey$map4[2],
        y2 = _mapKey$map4[3];

    var offsetX = Math.min(x1, x2);
    var offsetY = Math.min(y1, y2);

    var _pathMaker2 = new _path.PathMaker();

    _pathMaker2.moveTo(x1 - offsetX, y1 - offsetY);

    _pathMaker2.lineTo(x2 - offsetX, y2 - offsetY);

    postActions(_pathMaker2);
  } else if (dom instanceof SVGPathElement) {
    var pathData = dom.getAttribute('d') || '';
    var pathDataSeries = (0, _svgPathParser.parseSVG)(pathData);

    var _pathMaker3 = new _path.PathMaker();

    var pathDataWithType;
    pathDataSeries.forEach(function (pathDataItem) {
      switch (pathDataItem.code) {
        case 'M':
          pathDataWithType = pathDataItem;

          _pathMaker3.moveTo(pathDataWithType.x, pathDataWithType.y);

          break;

        case 'L':
          pathDataWithType = pathDataItem;

          _pathMaker3.lineTo(pathDataWithType.x, pathDataWithType.y);

          break;

        case 'l':
          pathDataWithType = pathDataItem;

          _pathMaker3.lineToRelative(pathDataWithType.x, pathDataWithType.y);

          break;

        case 'H':
          pathDataWithType = pathDataItem;

          _pathMaker3.horizontalTo(pathDataWithType.x);

          break;

        case 'h':
          pathDataWithType = pathDataItem;

          _pathMaker3.horizontalToRelative(pathDataWithType.x);

          break;

        case 'V':
          pathDataWithType = pathDataItem;

          _pathMaker3.verticalTo(pathDataWithType.y);

          break;

        case 'v':
          pathDataWithType = pathDataItem;

          _pathMaker3.verticalToRelative(pathDataWithType.y);

          break;

        case 'C':
          pathDataWithType = pathDataItem;

          _pathMaker3.cubicBezierCurveTo(pathDataWithType.x1, pathDataWithType.y1, pathDataWithType.x2, pathDataWithType.y2, pathDataWithType.x, pathDataWithType.y);

          break;

        case 'c':
          pathDataWithType = pathDataItem;

          _pathMaker3.cubicBezierCurveToRelative(pathDataWithType.x1, pathDataWithType.y1, pathDataWithType.x2, pathDataWithType.y2, pathDataWithType.x, pathDataWithType.y);

          break;

        case 'Q':
          pathDataWithType = pathDataItem;

          _pathMaker3.quadraticBezierCurveTo(pathDataWithType.x1, pathDataWithType.y1, pathDataWithType.x, pathDataWithType.y);

          break;

        case 'q':
          pathDataWithType = pathDataItem;

          _pathMaker3.quadraticBezierCurveToRelative(pathDataWithType.x1, pathDataWithType.y1, pathDataWithType.x, pathDataWithType.y);

          break;

        case 'A':
          pathDataWithType = pathDataItem;

          _pathMaker3.arcTo(pathDataWithType.rx, pathDataWithType.ry, pathDataWithType.xAxisRotation, ~~pathDataWithType.largeArc, ~~pathDataWithType.sweep, pathDataWithType.x, pathDataWithType.y);

          break;

        case 'a':
          pathDataWithType = pathDataItem;

          _pathMaker3.arcToRelative(pathDataWithType.rx, pathDataWithType.ry, pathDataWithType.xAxisRotation, ~~pathDataWithType.largeArc, ~~pathDataWithType.sweep, pathDataWithType.x, pathDataWithType.y);

          break;

        case 'Z':
        case 'z':
          _pathMaker3.closePath();

          break;

        default:
          console.error(pathDataItem);
          throw new Error('No implementation found for this path command.');
      }
    });
    postActions(_pathMaker3);
  } else if (dom instanceof SVGPolygonElement || dom instanceof SVGPolylineElement) {
    var points = dom.points;

    if (points.length) {
      var iterablePoints = Array.prototype.slice.call(points);

      var _offsetX = iterablePoints.reduce(function (p, v) {
        return Math.min(p, v.x);
      }, 0);

      var _offsetY = iterablePoints.reduce(function (p, v) {
        return Math.min(p, v.y);
      }, 0);

      var _pathMaker4 = new _path.PathMaker();

      _pathMaker4.moveTo(points[0].x - _offsetX, points[0].y - _offsetY);

      iterablePoints.forEach(function (v, i) {
        if (i <= 0) return;

        _pathMaker4.lineTo(v.x - _offsetX, v.y - _offsetY);
      });

      if (dom instanceof SVGPolygonElement) {
        _pathMaker4.closePath();
      }

      postActions(_pathMaker4);
    }
  } else if (dom instanceof SVGRectElement) {
    var _mapKey2 = ['width', 'height'];

    var _mapKey2$map = _mapKey2.map(function (key) {
      var svgLength = dom[key].baseVal;
      svgLength.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX);
      return svgLength.valueInSpecifiedUnits;
    }),
        _mapKey2$map2 = _slicedToArray(_mapKey2$map, 2),
        width = _mapKey2$map2[0],
        height = _mapKey2$map2[1];

    var _pathMaker5 = new _path.PathMaker();

    _pathMaker5.moveTo(0, 0);

    _pathMaker5.lineTo(width, 0);

    _pathMaker5.lineTo(width, height);

    _pathMaker5.lineTo(0, height);

    _pathMaker5.closePath();

    postActions(_pathMaker5);
  } else {
    console.error(dom);
    throw new Error('No implementation found for svg graphics element.');
  }

  return [group];
}

function renderGroup(dom, baseDom) {
  var items = [];
  dom.childNodes.forEach(function (node) {
    if (node instanceof SVGGraphicsElement) {
      items = render(node, baseDom || dom).concat(items);
    }
  });
  return items;
}

function renderPlainGlyph(type, args) {
  var group = {
    ty: "gr",
    it: [{
      ty: 'sh',
      ks: {
        k: null,
        a: 0
      },
      hd: false
    }, {
      ty: 'fl',
      c: {
        k: [1, 1, 1, 1]
      },
      o: {
        k: 100
      }
    }, {
      ty: 'tr',
      p: {
        k: [0, 0]
      },
      a: {
        k: [0, 0]
      },
      s: {
        k: [100, 100]
      },
      r: {
        k: 0
      },
      o: {
        k: 100
      },
      sk: {
        k: 0
      },
      sa: {
        k: 0
      }
    }],
    bm: 0,
    hd: false
  };
  var pathMaker = new _path.PathMaker();

  switch (type) {
    case 'rect':
      pathMaker.moveTo(0, 0);
      pathMaker.lineTo(args[0], 0);
      pathMaker.lineTo(args[0], args[1]);
      pathMaker.lineTo(0, args[1]);
      pathMaker.closePath();
      break;

    case 'ellipse':
      pathMaker.moveTo(args[0], 0);
      pathMaker.arcTo(args[0], args[1], 0, 1, 0, args[0], 2 * args[1]);
      pathMaker.arcTo(args[0], args[1], 0, 1, 0, args[0], 0);
      pathMaker.closePath();
  }

  pathMaker.uniform();
  group.it[0].ks.k = pathMaker.path;
  return group;
}

function renderText(dom, fontList) {
  var computedStyle = getComputedStyle(dom);
  var fontSize = parseFloat(computedStyle.fontSize),
      fontFamily = computedStyle.fontFamily.split(',')[0].trim(),
      fontStyle = computedStyle.fontStyle,
      fontWeight = computedStyle.fontWeight,
      fontColor = (computedStyle.color || 'rgb(0,0,0)').split('(')[1].split(')')[0].split(',').map(function (i) {
    return parseInt(i) / 255;
  });
  var fontName = (0, _v["default"])();

  if (fontList) {
    var fontExist = fontList.list.filter(function (font) {
      return font.fFamily == fontFamily && font.fStyle == fontStyle && font.fWeight == fontWeight;
    });
    if (fontExist.length) fontName = fontExist[0].fName;
  }

  var textData = {
    d: {
      k: [{
        t: 0,
        s: {
          s: fontSize,
          f: fontName,
          t: dom.innerHTML,
          j: 0,
          tr: 0,
          ls: 0,
          fc: fontColor
        }
      }]
    },
    p: {},
    m: {
      a: {
        k: [0, 0]
      }
    },
    a: []
  };
  var fontDef = {
    fFamily: fontFamily,
    fWeight: "".concat(fontWeight),
    fStyle: fontStyle,
    fName: fontName
  };
  return [textData, fontDef];
}

function renderImage(dom) {
  var id = (0, _v["default"])();
  var domHeightVal = dom.height.baseVal;
  domHeightVal.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX);
  var domWidthVal = dom.width.baseVal;
  domWidthVal.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX);
  var canvas = document.createElement('canvas');
  var ctx = canvas.getContext('2d');
  canvas.width = domWidthVal.valueInSpecifiedUnits;
  canvas.height = domHeightVal.valueInSpecifiedUnits;
  ctx.drawImage(dom, 0, 0);
  var dataUrl = canvas.toDataURL();
  var asset = {
    h: domHeightVal.valueInSpecifiedUnits,
    w: domWidthVal.valueInSpecifiedUnits,
    id: (0, _v["default"])(),
    u: dataUrl,
    e: 1
  };
  return [id, asset];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZW5kZXIudHMiXSwibmFtZXMiOlsicmVuZGVyIiwiZG9tIiwiYmFzZURvbSIsIlNWR1RleHRFbGVtZW50IiwiU1ZHSW1hZ2VFbGVtZW50IiwiU1ZHR0VsZW1lbnQiLCJyZW5kZXJHcm91cCIsInJlbmRlckdseXBoIiwiZW5jb2RlTGluZUNhcCIsInR5cGUiLCJlbmNvZGVMaW5lSm9pbiIsImFkZFZpc3VhbEVuY29kaW5ncyIsIml0ZW1zIiwic3R5bGVzIiwic3Ryb2tlIiwicHVzaCIsInR5IiwiYyIsImsiLCJzcGxpdCIsInNsaWNlIiwibWFwIiwicmF3IiwicGFyc2VJbnQiLCJjb25jYXQiLCJvIiwicGFyc2VGbG9hdCIsInN0cm9rZU9wYWNpdHkiLCJ3Iiwic3Ryb2tlV2lkdGgiLCJsYyIsInN0cm9rZUxpbmVjYXAiLCJsaiIsInN0cm9rZUxpbmVqb2luIiwiZmlsbCIsImZpbGxPcGFjaXR5IiwicG9zWCIsInBvc1kiLCJiYXNlVHJhbnNmb3JtIiwiYmFzZUJCb3giLCJnZXRCQm94IiwicmVmQkJveCIsImUiLCJ4IiwiZiIsInkiLCJwIiwiYSIsInMiLCJyIiwib3BhY2l0eSIsInNrIiwic2EiLCJncm91cCIsIml0IiwiYm0iLCJoZCIsInBvc3RBY3Rpb25zIiwicGF0aE1ha2VyIiwidW5pZm9ybSIsImtzIiwicGF0aCIsIm5tIiwiaWQiLCJ3aW5kb3ciLCJnZXRDb21wdXRlZFN0eWxlIiwiU1ZHQ2lyY2xlRWxlbWVudCIsInN2Z0xlbmd0aCIsImJhc2VWYWwiLCJjb252ZXJ0VG9TcGVjaWZpZWRVbml0cyIsIlNWR0xlbmd0aCIsIlNWR19MRU5HVEhUWVBFX1BYIiwidmFsdWVJblNwZWNpZmllZFVuaXRzIiwiUGF0aE1ha2VyIiwibW92ZVRvIiwiYXJjVG8iLCJjbG9zZVBhdGgiLCJTVkdFbGxpcHNlRWxlbWVudCIsIm1hcEtleSIsImtleSIsInJ4IiwicnkiLCJTVkdMaW5lRWxlbWVudCIsIngxIiwieDIiLCJ5MSIsInkyIiwib2Zmc2V0WCIsIk1hdGgiLCJtaW4iLCJvZmZzZXRZIiwibGluZVRvIiwiU1ZHUGF0aEVsZW1lbnQiLCJwYXRoRGF0YSIsImdldEF0dHJpYnV0ZSIsInBhdGhEYXRhU2VyaWVzIiwicGF0aERhdGFXaXRoVHlwZSIsImZvckVhY2giLCJwYXRoRGF0YUl0ZW0iLCJjb2RlIiwibGluZVRvUmVsYXRpdmUiLCJob3Jpem9udGFsVG8iLCJob3Jpem9udGFsVG9SZWxhdGl2ZSIsInZlcnRpY2FsVG8iLCJ2ZXJ0aWNhbFRvUmVsYXRpdmUiLCJjdWJpY0JlemllckN1cnZlVG8iLCJjdWJpY0JlemllckN1cnZlVG9SZWxhdGl2ZSIsInF1YWRyYXRpY0JlemllckN1cnZlVG8iLCJxdWFkcmF0aWNCZXppZXJDdXJ2ZVRvUmVsYXRpdmUiLCJ4QXhpc1JvdGF0aW9uIiwibGFyZ2VBcmMiLCJzd2VlcCIsImFyY1RvUmVsYXRpdmUiLCJjb25zb2xlIiwiZXJyb3IiLCJFcnJvciIsIlNWR1BvbHlnb25FbGVtZW50IiwiU1ZHUG9seWxpbmVFbGVtZW50IiwicG9pbnRzIiwibGVuZ3RoIiwiaXRlcmFibGVQb2ludHMiLCJBcnJheSIsInByb3RvdHlwZSIsImNhbGwiLCJyZWR1Y2UiLCJ2IiwiaSIsIlNWR1JlY3RFbGVtZW50Iiwid2lkdGgiLCJoZWlnaHQiLCJjaGlsZE5vZGVzIiwibm9kZSIsIlNWR0dyYXBoaWNzRWxlbWVudCIsInJlbmRlclBsYWluR2x5cGgiLCJhcmdzIiwicmVuZGVyVGV4dCIsImZvbnRMaXN0IiwiY29tcHV0ZWRTdHlsZSIsImZvbnRTaXplIiwiZm9udEZhbWlseSIsInRyaW0iLCJmb250U3R5bGUiLCJmb250V2VpZ2h0IiwiZm9udENvbG9yIiwiY29sb3IiLCJmb250TmFtZSIsImZvbnRFeGlzdCIsImxpc3QiLCJmaWx0ZXIiLCJmb250IiwiZkZhbWlseSIsImZTdHlsZSIsImZXZWlnaHQiLCJmTmFtZSIsInRleHREYXRhIiwiZCIsInQiLCJpbm5lckhUTUwiLCJqIiwidHIiLCJscyIsImZjIiwibSIsImZvbnREZWYiLCJyZW5kZXJJbWFnZSIsImRvbUhlaWdodFZhbCIsImRvbVdpZHRoVmFsIiwiY2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY3R4IiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsImRhdGFVcmwiLCJ0b0RhdGFVUkwiLCJhc3NldCIsImgiLCJ1Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUdPLFNBQVNBLE1BQVQsQ0FBZ0JDLEdBQWhCLEVBQXlDQyxPQUF6QyxFQUFxRjtBQUN4RixNQUFJRCxHQUFHLFlBQVlFLGNBQWYsSUFBaUNGLEdBQUcsWUFBWUcsZUFBcEQsRUFBcUU7QUFDakUsV0FBTyxFQUFQO0FBQ0gsR0FGRCxNQUVPLElBQUlILEdBQUcsWUFBWUksV0FBbkIsRUFBZ0M7QUFDbkMsV0FBT0MsV0FBVyxDQUFDTCxHQUFELEVBQU1DLE9BQU4sQ0FBbEI7QUFDSCxHQUZNLE1BRUE7QUFDSCxXQUFPSyxXQUFXLENBQUNOLEdBQUQsRUFBTUMsT0FBTixDQUFsQjtBQUNIO0FBQ0o7O0FBRUQsU0FBU00sYUFBVCxDQUF1QkMsSUFBdkIsRUFBcUQ7QUFDakQsVUFBUUEsSUFBUjtBQUNJLFNBQUssUUFBTDtBQUNJLGFBQU8sQ0FBUDs7QUFDSixTQUFLLE1BQUw7QUFDSSxhQUFPLENBQVA7O0FBQ0o7QUFDSSxhQUFPLENBQVA7QUFOUjtBQVFIOztBQUVELFNBQVNDLGNBQVQsQ0FBd0JELElBQXhCLEVBQXNEO0FBQ2xELFVBQVFBLElBQVI7QUFDSSxTQUFLLE9BQUw7QUFDSSxhQUFPLENBQVA7O0FBQ0osU0FBSyxPQUFMO0FBQ0ksYUFBTyxDQUFQOztBQUNKO0FBQ0ksYUFBTyxDQUFQO0FBTlI7QUFRSDs7QUFJRCxTQUFTRSxrQkFBVCxDQUE0QkMsS0FBNUIsRUFBc0RDLE1BQXRELEVBQW1GWixHQUFuRixFQUE2R0MsT0FBN0csRUFBMkk7QUFDdkksTUFBSVcsTUFBTSxDQUFDQyxNQUFQLElBQWlCRCxNQUFNLENBQUND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U0FBUCxFQUFoQjtBQUNBLE1BQU1DLEtBQUssR0FBRztBQUNWQyxJQUFBQSxDQUFDLEVBQUVYLFlBQVksQ0FBQzdGLHFCQUROO0FBRVY1QyxJQUFBQSxDQUFDLEVBQUUwSSxXQUFXLENBQUM5RixxQkFGTDtBQUdWVCxJQUFBQSxFQUFFLEVBQUUsb0JBSE07QUFJVmtILElBQUFBLENBQUMsRUFBRUosT0FKTztBQUtWbkksSUFBQUEsQ0FBQyxFQUFFO0FBTE8sR0FBZDtBQU9BLFNBQU8sQ0FBQ3FCLEVBQUQsRUFBS2dILEtBQUwsQ0FBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR3JvdXBTaGFwZSwgVGV4dERhdGEsIFJlZmVyZW5jZUlELCBQYXRoU2hhcGUsIEZpbGxTaGFwZSwgU3Ryb2tlU2hhcGUsIFRyYW5zZm9ybVNoYXBlLCBJbWFnZUFzc2V0LCBGb250MSwgRm9udHMgfSBmcm9tICcuL2FuaW1hdGlvbidcbmltcG9ydCB7IFBhdGhNYWtlciB9IGZyb20gJy4vcGF0aCdcbmltcG9ydCB1dWlkIGZyb20gJ3V1aWQvdjQnXG5pbXBvcnQgeyBwYXJzZVNWRywgTW92ZVRvQ29tbWFuZCwgTGluZVRvQ29tbWFuZCwgSG9yaXpvbnRhbExpbmVUb0NvbW1hbmQsIFZlcnRpY2FsTGluZVRvQ29tbWFuZCwgQ3VydmVUb0NvbW1hbmQsIFF1YWRyYXRpY0N1cnZlVG9Db21tYW5kLCBFbGxpcHRpY2FsQXJjQ29tbWFuZCB9IGZyb20gJ3N2Zy1wYXRoLXBhcnNlcidcbmltcG9ydCB7IGNhbGN1bGF0ZUJhc2VUcmFuc2Zvcm0gfSBmcm9tICcuL2hlbHBlcidcblxuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyKGRvbTogU1ZHR3JhcGhpY3NFbGVtZW50LCBiYXNlRG9tPzogU1ZHR3JhcGhpY3NFbGVtZW50KTogR3JvdXBTaGFwZVtdIHtcbiAgICBpZiAoZG9tIGluc3RhbmNlb2YgU1ZHVGV4dEVsZW1lbnQgfHwgZG9tIGluc3RhbmNlb2YgU1ZHSW1hZ2VFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgIH0gZWxzZSBpZiAoZG9tIGluc3RhbmNlb2YgU1ZHR0VsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckdyb3VwKGRvbSwgYmFzZURvbSlcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVuZGVyR2x5cGgoZG9tLCBiYXNlRG9tKVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZW5jb2RlTGluZUNhcCh0eXBlPzogc3RyaW5nIHwgbnVsbCk6IG51bWJlciB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgJ3NxdWFyZSc6XG4gICAgICAgICAgICByZXR1cm4gM1xuICAgICAgICBjYXNlICdidXR0JzpcbiAgICAgICAgICAgIHJldHVybiAxXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gMlxuICAgIH1cbn1cblxuZnVuY3Rpb24gZW5jb2RlTGluZUpvaW4odHlwZT86IHN0cmluZyB8IG51bGwpOiBudW1iZXIge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdtaXRlcic6XG4gICAgICAgICAgICByZXR1cm4gMVxuICAgICAgICBjYXNlICdiZXZlbCc6XG4gICAgICAgICAgICByZXR1cm4gM1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIDJcbiAgICB9XG59XG5cbnR5cGUgVmlzdWFsR3JvdXBJdGVtID0gUGF0aFNoYXBlIHwgRmlsbFNoYXBlIHwgU3Ryb2tlU2hhcGUgfCBUcmFuc2Zvcm1TaGFwZVxuXG5mdW5jdGlvbiBhZGRWaXN1YWxFbmNvZGluZ3MoaXRlbXM6IFZpc3VhbEdyb3VwSXRlbVtdLCBzdHlsZXM6IENTU1N0eWxlRGVjbGFyYXRpb24sIGRvbT86IFNWR0dyYXBoaWNzRWxlbWVudCwgYmFzZURvbT86IFNWR0dyYXBoaWNzRWxlbWVudCkge1xuICAgIGlmIChzdHlsZXMuc3Ryb2tlICYmIHN0eWxlcy5zdHJva2UgIT09ICdub25lJykge1xuICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgIHR5OiAnc3QnLFxuICAgICAgICAgICAgYzoge1xuICAgICAgICAgICAgICAgIGs6IHN0eWxlcy5zdHJva2UhLnNwbGl0KCcoJylbMV0uc3BsaXQoJyknKVswXS5zcGxpdCgnLCcpLnNsaWNlKDAsIDMpLm1hcCgocmF3OiBzdHJpbmcpID0+IHBhcnNlSW50KHJhdykgLyAyNTUpLmNvbmNhdCgxKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG86IHtcbiAgICAgICAgICAgICAgICBrOiBwYXJzZUZsb2F0KHN0eWxlcy5zdHJva2VPcGFjaXR5IHx8ICcxJykgKiAxMDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3OiB7XG4gICAgICAgICAgICAgICAgazogcGFyc2VGbG9hdChzdHlsZXMuc3Ryb2tlV2lkdGggfHwgJzEnKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxjOiBlbmNvZGVMaW5lQ2FwKHN0eWxlcy5zdHJva2VMaW5lY2FwKSxcbiAgICAgICAgICAgIGxqOiBlbmNvZGVMaW5lSm9pbihzdHlsZXMuc3Ryb2tlTGluZWpvaW4pXG4gICAgICAgIH0pXG4gICAgfVxuICAgIGlmIChzdHlsZXMuZmlsbCAmJiBzdHlsZXMuZmlsbCAhPT0gJ25vbmUnKSB7XG4gICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgdHk6ICdmbCcsXG4gICAgICAgICAgICBjOiB7XG4gICAgICAgICAgICAgICAgazogc3R5bGVzLmZpbGwhLnNwbGl0KCcoJylbMV0uc3BsaXQoJyknKVswXS5zcGxpdCgnLCcpLnNsaWNlKDAsIDMpLm1hcCgocmF3OiBzdHJpbmcpID0+IHBhcnNlSW50KHJhdykgLyAyNTUpLmNvbmNhdCgxKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG86IHtcbiAgICAgICAgICAgICAgICBrOiBwYXJzZUZsb2F0KHN0eWxlcy5maWxsT3BhY2l0eSB8fCAnMScpICogMTAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuICAgIGxldCBwb3NYID0gMCwgcG9zWSA9IDBcbiAgICBpZiAoZG9tICYmIGJhc2VEb20pIHtcbiAgICAgICAgY29uc3QgYmFzZVRyYW5zZm9ybSA9IGNhbGN1bGF0ZUJhc2VUcmFuc2Zvcm0oZG9tLCBiYXNlRG9tKVxuICAgICAgICBjb25zdCBiYXNlQkJveCA9IGJhc2VEb20uZ2V0QkJveCgpXG4gICAgICAgIGNvbnN0IHJlZkJCb3ggPSBkb20uZ2V0QkJveCgpXG4gICAgICAgIHBvc1ggPSBiYXNlVHJhbnNmb3JtLmUgKyByZWZCQm94LnggLSBiYXNlQkJveC54XG4gICAgICAgIHBvc1kgPSBiYXNlVHJhbnNmb3JtLmYgKyByZWZCQm94LnkgLSBiYXNlQkJveC55XG4gICAgfVxuICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICB0eTogXCJ0clwiLFxuICAgICAgICBwOiB7XG4gICAgICAgICAgICBrOiBbXG4gICAgICAgICAgICAgICAgcG9zWCxcbiAgICAgICAgICAgICAgICBwb3NZXG4gICAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGE6IHtcbiAgICAgICAgICAgIGs6IFtcbiAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgIDBcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAgczoge1xuICAgICAgICAgICAgazogW1xuICAgICAgICAgICAgICAgIDEwMCxcbiAgICAgICAgICAgICAgICAxMDBcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAgcjoge1xuICAgICAgICAgICAgazogMFxuICAgICAgICB9LFxuICAgICAgICBvOiB7XG4gICAgICAgICAgICBrOiBwYXJzZUZsb2F0KHN0eWxlcy5vcGFjaXR5IHx8ICcxJykgKiAxMDBcbiAgICAgICAgfSxcbiAgICAgICAgc2s6IHtcbiAgICAgICAgICAgIGs6IDBcbiAgICAgICAgfSxcbiAgICAgICAgc2E6IHtcbiAgICAgICAgICAgIGs6IDBcbiAgICAgICAgfVxuICAgIH0pXG5cbn1cblxuZnVuY3Rpb24gcmVuZGVyR2x5cGgoZG9tOiBTVkdHcmFwaGljc0VsZW1lbnQsIGJhc2VEb20/OiBTVkdHcmFwaGljc0VsZW1lbnQpOiBHcm91cFNoYXBlW10ge1xuICAgIGNvbnN0IGdyb3VwOiBHcm91cFNoYXBlID0ge1xuICAgICAgICB0eTogXCJnclwiLFxuICAgICAgICBpdDogW10sXG4gICAgICAgIGJtOiAwLFxuICAgICAgICBoZDogZmFsc2VcbiAgICB9XG4gICAgY29uc3QgcG9zdEFjdGlvbnMgPSAocGF0aE1ha2VyOiBQYXRoTWFrZXIpID0+IHtcbiAgICAgICAgcGF0aE1ha2VyLnVuaWZvcm0oKVxuICAgICAgICBncm91cC5pdCEucHVzaCh7XG4gICAgICAgICAgICB0eTogJ3NoJyxcbiAgICAgICAgICAgIGtzOiB7XG4gICAgICAgICAgICAgICAgazogcGF0aE1ha2VyLnBhdGgsXG4gICAgICAgICAgICAgICAgYTogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5tOiBkb20uaWQsXG4gICAgICAgICAgICBoZDogZmFsc2VcbiAgICAgICAgfSlcbiAgICAgICAgY29uc3Qgc3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9tKVxuICAgICAgICBhZGRWaXN1YWxFbmNvZGluZ3MoZ3JvdXAuaXQhIGFzIFZpc3VhbEdyb3VwSXRlbVtdLCBzdHlsZXMsIGRvbSwgYmFzZURvbSlcbiAgICB9XG4gICAgaWYgKGRvbSBpbnN0YW5jZW9mIFNWR0NpcmNsZUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc3ZnTGVuZ3RoID0gZG9tLnIuYmFzZVZhbFxuICAgICAgICBzdmdMZW5ndGguY29udmVydFRvU3BlY2lmaWVkVW5pdHMoU1ZHTGVuZ3RoLlNWR19MRU5HVEhUWVBFX1BYKVxuICAgICAgICBjb25zdCByID0gc3ZnTGVuZ3RoLnZhbHVlSW5TcGVjaWZpZWRVbml0c1xuICAgICAgICBjb25zdCBwYXRoTWFrZXIgPSBuZXcgUGF0aE1ha2VyKClcbiAgICAgICAgcGF0aE1ha2VyLm1vdmVUbyhyLCAwKVxuICAgICAgICBwYXRoTWFrZXIuYXJjVG8ociwgciwgMCwgMSwgMCwgciwgMiAqIHIpXG4gICAgICAgIHBhdGhNYWtlci5hcmNUbyhyLCByLCAwLCAxLCAwLCByLCAwKVxuICAgICAgICBwYXRoTWFrZXIuY2xvc2VQYXRoKClcbiAgICAgICAgcG9zdEFjdGlvbnMocGF0aE1ha2VyKVxuICAgIH0gZWxzZSBpZiAoZG9tIGluc3RhbmNlb2YgU1ZHRWxsaXBzZUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgbWFwS2V5OiAoJ3J4JyB8ICdyeScpW10gPSBbJ3J4JywgJ3J5J11cbiAgICAgICAgY29uc3QgW3J4LCByeV0gPSBtYXBLZXkubWFwKGtleSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdmdMZW5ndGggPSBkb21ba2V5XS5iYXNlVmFsXG4gICAgICAgICAgICBzdmdMZW5ndGguY29udmVydFRvU3BlY2lmaWVkVW5pdHMoU1ZHTGVuZ3RoLlNWR19MRU5HVEhUWVBFX1BYKVxuICAgICAgICAgICAgcmV0dXJuIHN2Z0xlbmd0aC52YWx1ZUluU3BlY2lmaWVkVW5pdHNcbiAgICAgICAgfSlcbiAgICAgICAgY29uc3QgcGF0aE1ha2VyID0gbmV3IFBhdGhNYWtlcigpXG4gICAgICAgIHBhdGhNYWtlci5tb3ZlVG8ocngsIDApXG4gICAgICAgIHBhdGhNYWtlci5hcmNUbyhyeCwgcnksIDAsIDEsIDAsIHJ4LCAyICogcnkpXG4gICAgICAgIHBhdGhNYWtlci5hcmNUbyhyeCwgcnksIDAsIDEsIDAsIHJ4LCAwKVxuICAgICAgICBwYXRoTWFrZXIuY2xvc2VQYXRoKClcbiAgICAgICAgcG9zdEFjdGlvbnMocGF0aE1ha2VyKVxuICAgIH0gZWxzZSBpZiAoZG9tIGluc3RhbmNlb2YgU1ZHTGluZUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgbWFwS2V5OiAoJ3gxJyB8ICd4MicgfCAneTEnIHwgJ3kyJylbXSA9IFsneDEnLCAneDInLCAneTEnLCAneTInXVxuICAgICAgICBjb25zdCBbeDEsIHgyLCB5MSwgeTJdID0gbWFwS2V5Lm1hcChrZXkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3ZnTGVuZ3RoID0gZG9tW2tleV0uYmFzZVZhbFxuICAgICAgICAgICAgc3ZnTGVuZ3RoLmNvbnZlcnRUb1NwZWNpZmllZFVuaXRzKFNWR0xlbmd0aC5TVkdfTEVOR1RIVFlQRV9QWClcbiAgICAgICAgICAgIHJldHVybiBzdmdMZW5ndGgudmFsdWVJblNwZWNpZmllZFVuaXRzXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnN0IG9mZnNldFggPSBNYXRoLm1pbih4MSwgeDIpXG4gICAgICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLm1pbih5MSwgeTIpXG4gICAgICAgIGNvbnN0IHBhdGhNYWtlciA9IG5ldyBQYXRoTWFrZXIoKVxuICAgICAgICBwYXRoTWFrZXIubW92ZVRvKHgxIC0gb2Zmc2V0WCwgeTEgLSBvZmZzZXRZKVxuICAgICAgICBwYXRoTWFrZXIubGluZVRvKHgyIC0gb2Zmc2V0WCwgeTIgLSBvZmZzZXRZKVxuICAgICAgICBwb3N0QWN0aW9ucyhwYXRoTWFrZXIpXG4gICAgfSBlbHNlIGlmIChkb20gaW5zdGFuY2VvZiBTVkdQYXRoRWxlbWVudCkge1xuICAgICAgICBjb25zdCBwYXRoRGF0YSA9IGRvbS5nZXRBdHRyaWJ1dGUoJ2QnKSB8fCAnJ1xuICAgICAgICBjb25zdCBwYXRoRGF0YVNlcmllcyA9IHBhcnNlU1ZHKHBhdGhEYXRhKVxuICAgICAgICBjb25zdCBwYXRoTWFrZXIgPSBuZXcgUGF0aE1ha2VyKClcbiAgICAgICAgbGV0IHBhdGhEYXRhV2l0aFR5cGU7XG4gICAgICAgIHBhdGhEYXRhU2VyaWVzLmZvckVhY2gocGF0aERhdGFJdGVtID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAocGF0aERhdGFJdGVtLmNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdNJzpcbiAgICAgICAgICAgICAgICAgICAgcGF0aERhdGFXaXRoVHlwZSA9IHBhdGhEYXRhSXRlbSBhcyBNb3ZlVG9Db21tYW5kXG4gICAgICAgICAgICAgICAgICAgIHBhdGhNYWtlci5tb3ZlVG8ocGF0aERhdGFXaXRoVHlwZS54LCBwYXRoRGF0YVdpdGhUeXBlLnkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnTCc6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhEYXRhV2l0aFR5cGUgPSBwYXRoRGF0YUl0ZW0gYXMgTGluZVRvQ29tbWFuZFxuICAgICAgICAgICAgICAgICAgICBwYXRoTWFrZXIubGluZVRvKHBhdGhEYXRhV2l0aFR5cGUueCwgcGF0aERhdGFXaXRoVHlwZS55KVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNhc2UgJ2wnOlxuICAgICAgICAgICAgICAgICAgICBwYXRoRGF0YVdpdGhUeXBlID0gcGF0aERhdGFJdGVtIGFzIExpbmVUb0NvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1ha2VyLmxpbmVUb1JlbGF0aXZlKHBhdGhEYXRhV2l0aFR5cGUueCwgcGF0aERhdGFXaXRoVHlwZS55KVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNhc2UgJ0gnOlxuICAgICAgICAgICAgICAgICAgICBwYXRoRGF0YVdpdGhUeXBlID0gcGF0aERhdGFJdGVtIGFzIEhvcml6b250YWxMaW5lVG9Db21tYW5kXG4gICAgICAgICAgICAgICAgICAgIHBhdGhNYWtlci5ob3Jpem9udGFsVG8ocGF0aERhdGFXaXRoVHlwZS54KVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNhc2UgJ2gnOlxuICAgICAgICAgICAgICAgICAgICBwYXRoRGF0YVdpdGhUeXBlID0gcGF0aERhdGFJdGVtIGFzIEhvcml6b250YWxMaW5lVG9Db21tYW5kXG4gICAgICAgICAgICAgICAgICAgIHBhdGhNYWtlci5ob3Jpem9udGFsVG9SZWxhdGl2ZShwYXRoRGF0YVdpdGhUeXBlLngpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnVic6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhEYXRhV2l0aFR5cGUgPSBwYXRoRGF0YUl0ZW0gYXMgVmVydGljYWxMaW5lVG9Db21tYW5kXG4gICAgICAgICAgICAgICAgICAgIHBhdGhNYWtlci52ZXJ0aWNhbFRvKHBhdGhEYXRhV2l0aFR5cGUueSlcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICBjYXNlICd2JzpcbiAgICAgICAgICAgICAgICAgICAgcGF0aERhdGFXaXRoVHlwZSA9IHBhdGhEYXRhSXRlbSBhcyBWZXJ0aWNhbExpbmVUb0NvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1ha2VyLnZlcnRpY2FsVG9SZWxhdGl2ZShwYXRoRGF0YVdpdGhUeXBlLnkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnQyc6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhEYXRhV2l0aFR5cGUgPSBwYXRoRGF0YUl0ZW0gYXMgQ3VydmVUb0NvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1ha2VyLmN1YmljQmV6aWVyQ3VydmVUbyhwYXRoRGF0YVdpdGhUeXBlLngxLCBwYXRoRGF0YVdpdGhUeXBlLnkxLCBwYXRoRGF0YVdpdGhUeXBlLngyLCBwYXRoRGF0YVdpdGhUeXBlLnkyLCBwYXRoRGF0YVdpdGhUeXBlLngsIHBhdGhEYXRhV2l0aFR5cGUueSlcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICBjYXNlICdjJzpcbiAgICAgICAgICAgICAgICAgICAgcGF0aERhdGFXaXRoVHlwZSA9IHBhdGhEYXRhSXRlbSBhcyBDdXJ2ZVRvQ29tbWFuZFxuICAgICAgICAgICAgICAgICAgICBwYXRoTWFrZXIuY3ViaWNCZXppZXJDdXJ2ZVRvUmVsYXRpdmUocGF0aERhdGFXaXRoVHlwZS54MSwgcGF0aERhdGFXaXRoVHlwZS55MSwgcGF0aERhdGFXaXRoVHlwZS54MiwgcGF0aERhdGFXaXRoVHlwZS55MiwgcGF0aERhdGFXaXRoVHlwZS54LCBwYXRoRGF0YVdpdGhUeXBlLnkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnUSc6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhEYXRhV2l0aFR5cGUgPSBwYXRoRGF0YUl0ZW0gYXMgUXVhZHJhdGljQ3VydmVUb0NvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1ha2VyLnF1YWRyYXRpY0JlemllckN1cnZlVG8ocGF0aERhdGFXaXRoVHlwZS54MSwgcGF0aERhdGFXaXRoVHlwZS55MSwgcGF0aERhdGFXaXRoVHlwZS54LCBwYXRoRGF0YVdpdGhUeXBlLnkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAncSc6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhEYXRhV2l0aFR5cGUgPSBwYXRoRGF0YUl0ZW0gYXMgUXVhZHJhdGljQ3VydmVUb0NvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1ha2VyLnF1YWRyYXRpY0JlemllckN1cnZlVG9SZWxhdGl2ZShwYXRoRGF0YVdpdGhUeXBlLngxLCBwYXRoRGF0YVdpdGhUeXBlLnkxLCBwYXRoRGF0YVdpdGhUeXBlLngsIHBhdGhEYXRhV2l0aFR5cGUueSlcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICBjYXNlICdBJzpcbiAgICAgICAgICAgICAgICAgICAgcGF0aERhdGFXaXRoVHlwZSA9IHBhdGhEYXRhSXRlbSBhcyBFbGxpcHRpY2FsQXJjQ29tbWFuZFxuICAgICAgICAgICAgICAgICAgICBwYXRoTWFrZXIuYXJjVG8ocGF0aERhdGFXaXRoVHlwZS5yeCwgcGF0aERhdGFXaXRoVHlwZS5yeSwgcGF0aERhdGFXaXRoVHlwZS54QXhpc1JvdGF0aW9uLCB+fnBhdGhEYXRhV2l0aFR5cGUubGFyZ2VBcmMsIH5+cGF0aERhdGFXaXRoVHlwZS5zd2VlcCwgcGF0aERhdGFXaXRoVHlwZS54LCBwYXRoRGF0YVdpdGhUeXBlLnkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnYSc6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhEYXRhV2l0aFR5cGUgPSBwYXRoRGF0YUl0ZW0gYXMgRWxsaXB0aWNhbEFyY0NvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1ha2VyLmFyY1RvUmVsYXRpdmUocGF0aERhdGFXaXRoVHlwZS5yeCwgcGF0aERhdGFXaXRoVHlwZS5yeSwgcGF0aERhdGFXaXRoVHlwZS54QXhpc1JvdGF0aW9uLCB+fnBhdGhEYXRhV2l0aFR5cGUubGFyZ2VBcmMsIH5+cGF0aERhdGFXaXRoVHlwZS5zd2VlcCwgcGF0aERhdGFXaXRoVHlwZS54LCBwYXRoRGF0YVdpdGhUeXBlLnkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnWic6XG4gICAgICAgICAgICAgICAgY2FzZSAneic6XG4gICAgICAgICAgICAgICAgICAgIHBhdGhNYWtlci5jbG9zZVBhdGgoKVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IocGF0aERhdGFJdGVtKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGltcGxlbWVudGF0aW9uIGZvdW5kIGZvciB0aGlzIHBhdGggY29tbWFuZC4nKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBwb3N0QWN0aW9ucyhwYXRoTWFrZXIpXG4gICAgfSBlbHNlIGlmIChkb20gaW5zdGFuY2VvZiBTVkdQb2x5Z29uRWxlbWVudCB8fCBkb20gaW5zdGFuY2VvZiBTVkdQb2x5bGluZUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgcG9pbnRzID0gZG9tLnBvaW50c1xuICAgICAgICBpZiAocG9pbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgaXRlcmFibGVQb2ludHM6IERPTVBvaW50W10gPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChwb2ludHMpXG4gICAgICAgICAgICBjb25zdCBvZmZzZXRYID0gaXRlcmFibGVQb2ludHMucmVkdWNlKChwLCB2KSA9PiBNYXRoLm1pbihwLCB2LngpLCAwKVxuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0WSA9IGl0ZXJhYmxlUG9pbnRzLnJlZHVjZSgocCwgdikgPT4gTWF0aC5taW4ocCwgdi55KSwgMClcbiAgICAgICAgICAgIGNvbnN0IHBhdGhNYWtlciA9IG5ldyBQYXRoTWFrZXIoKVxuICAgICAgICAgICAgcGF0aE1ha2VyLm1vdmVUbyhwb2ludHNbMF0ueCAtIG9mZnNldFgsIHBvaW50c1swXS55IC0gb2Zmc2V0WSlcbiAgICAgICAgICAgIGl0ZXJhYmxlUG9pbnRzLmZvckVhY2goKHYsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaSA8PSAwKSByZXR1cm5cbiAgICAgICAgICAgICAgICBwYXRoTWFrZXIubGluZVRvKHYueCAtIG9mZnNldFgsIHYueSAtIG9mZnNldFkpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgaWYgKGRvbSBpbnN0YW5jZW9mIFNWR1BvbHlnb25FbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcGF0aE1ha2VyLmNsb3NlUGF0aCgpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3N0QWN0aW9ucyhwYXRoTWFrZXIpXG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRvbSBpbnN0YW5jZW9mIFNWR1JlY3RFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IG1hcEtleTogKCd3aWR0aCcgfCAnaGVpZ2h0JylbXSA9IFsnd2lkdGgnLCAnaGVpZ2h0J11cbiAgICAgICAgY29uc3QgW3dpZHRoLCBoZWlnaHRdID0gbWFwS2V5Lm1hcChrZXkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3ZnTGVuZ3RoID0gZG9tW2tleV0uYmFzZVZhbFxuICAgICAgICAgICAgc3ZnTGVuZ3RoLmNvbnZlcnRUb1NwZWNpZmllZFVuaXRzKFNWR0xlbmd0aC5TVkdfTEVOR1RIVFlQRV9QWClcbiAgICAgICAgICAgIHJldHVybiBzdmdMZW5ndGgudmFsdWVJblNwZWNpZmllZFVuaXRzXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnN0IHBhdGhNYWtlciA9IG5ldyBQYXRoTWFrZXIoKVxuICAgICAgICBwYXRoTWFrZXIubW92ZVRvKDAsIDApXG4gICAgICAgIHBhdGhNYWtlci5saW5lVG8od2lkdGgsIDApXG4gICAgICAgIHBhdGhNYWtlci5saW5lVG8od2lkdGgsIGhlaWdodClcbiAgICAgICAgcGF0aE1ha2VyLmxpbmVUbygwLCBoZWlnaHQpXG4gICAgICAgIHBhdGhNYWtlci5jbG9zZVBhdGgoKVxuICAgICAgICBwb3N0QWN0aW9ucyhwYXRoTWFrZXIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihkb20pXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gaW1wbGVtZW50YXRpb24gZm91bmQgZm9yIHN2ZyBncmFwaGljcyBlbGVtZW50LicpXG4gICAgfVxuICAgIHJldHVybiBbZ3JvdXBdXG59XG5cbmZ1bmN0aW9uIHJlbmRlckdyb3VwKGRvbTogU1ZHR0VsZW1lbnQsIGJhc2VEb20/OiBTVkdHcmFwaGljc0VsZW1lbnQpOiBHcm91cFNoYXBlW10ge1xuICAgIGxldCBpdGVtczogR3JvdXBTaGFwZVtdID0gW11cbiAgICBkb20uY2hpbGROb2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIFNWR0dyYXBoaWNzRWxlbWVudCkge1xuICAgICAgICAgICAgaXRlbXMgPSByZW5kZXIobm9kZSwgYmFzZURvbSB8fCBkb20pLmNvbmNhdChpdGVtcylcbiAgICAgICAgfVxuICAgIH0pXG4gICAgcmV0dXJuIGl0ZW1zXG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJQbGFpbkdseXBoKHR5cGU6ICdyZWN0JyB8ICdlbGxpcHNlJywgYXJnczogbnVtYmVyW10pOiBHcm91cFNoYXBlIHtcbiAgICBjb25zdCBncm91cDogR3JvdXBTaGFwZSA9IHtcbiAgICAgICAgdHk6IFwiZ3JcIixcbiAgICAgICAgaXQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eTogJ3NoJyxcbiAgICAgICAgICAgICAgICBrczoge1xuICAgICAgICAgICAgICAgICAgICBrOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBhOiAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBoZDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHk6ICdmbCcsXG4gICAgICAgICAgICAgICAgYzoge1xuICAgICAgICAgICAgICAgICAgICBrOiBbMSwgMSwgMSwgMV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG86IHtcbiAgICAgICAgICAgICAgICAgICAgazogMTAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eTogJ3RyJyxcbiAgICAgICAgICAgICAgICBwOiB7XG4gICAgICAgICAgICAgICAgICAgIGs6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAwXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGE6IHtcbiAgICAgICAgICAgICAgICAgICAgazogW1xuICAgICAgICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIDBcbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgczoge1xuICAgICAgICAgICAgICAgICAgICBrOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAxMDBcbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcjoge1xuICAgICAgICAgICAgICAgICAgICBrOiAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvOiB7XG4gICAgICAgICAgICAgICAgICAgIGs6IDEwMFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2s6IHtcbiAgICAgICAgICAgICAgICAgICAgazogMFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2E6IHtcbiAgICAgICAgICAgICAgICAgICAgazogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgYm06IDAsXG4gICAgICAgIGhkOiBmYWxzZVxuICAgIH1cbiAgICBjb25zdCBwYXRoTWFrZXIgPSBuZXcgUGF0aE1ha2VyKClcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAncmVjdCc6XG4gICAgICAgICAgICBwYXRoTWFrZXIubW92ZVRvKDAsIDApXG4gICAgICAgICAgICBwYXRoTWFrZXIubGluZVRvKGFyZ3NbMF0sIDApXG4gICAgICAgICAgICBwYXRoTWFrZXIubGluZVRvKGFyZ3NbMF0sIGFyZ3NbMV0pXG4gICAgICAgICAgICBwYXRoTWFrZXIubGluZVRvKDAsIGFyZ3NbMV0pXG4gICAgICAgICAgICBwYXRoTWFrZXIuY2xvc2VQYXRoKClcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ2VsbGlwc2UnOlxuICAgICAgICAgICAgcGF0aE1ha2VyLm1vdmVUbyhhcmdzWzBdLCAwKVxuICAgICAgICAgICAgcGF0aE1ha2VyLmFyY1RvKGFyZ3NbMF0sIGFyZ3NbMV0sIDAsIDEsIDAsIGFyZ3NbMF0sIDIgKiBhcmdzWzFdKVxuICAgICAgICAgICAgcGF0aE1ha2VyLmFyY1RvKGFyZ3NbMF0sIGFyZ3NbMV0sIDAsIDEsIDAsIGFyZ3NbMF0sIDApXG4gICAgICAgICAgICBwYXRoTWFrZXIuY2xvc2VQYXRoKClcbiAgICB9XG4gICAgcGF0aE1ha2VyLnVuaWZvcm0oKTtcbiAgICAoZ3JvdXAuaXQhWzBdIGFzIFBhdGhTaGFwZSkua3MhLmsgPSBwYXRoTWFrZXIucGF0aFxuICAgIHJldHVybiBncm91cFxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyVGV4dChkb206IFNWR1RleHRFbGVtZW50LCBmb250TGlzdD86IEZvbnRzKTogW1RleHREYXRhLCBGb250MV0ge1xuICAgIGNvbnN0IGNvbXB1dGVkU3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGRvbSlcbiAgICBjb25zdCBmb250U2l6ZSA9IHBhcnNlRmxvYXQoY29tcHV0ZWRTdHlsZS5mb250U2l6ZSksXG4gICAgICAgIGZvbnRGYW1pbHkgPSBjb21wdXRlZFN0eWxlLmZvbnRGYW1pbHkuc3BsaXQoJywnKVswXS50cmltKCksXG4gICAgICAgIGZvbnRTdHlsZSA9IGNvbXB1dGVkU3R5bGUuZm9udFN0eWxlLFxuICAgICAgICBmb250V2VpZ2h0ID0gY29tcHV0ZWRTdHlsZS5mb250V2VpZ2h0LFxuICAgICAgICBmb250Q29sb3IgPSAoY29tcHV0ZWRTdHlsZS5jb2xvciB8fCAncmdiKDAsMCwwKScpLnNwbGl0KCcoJylbMV0uc3BsaXQoJyknKVswXS5zcGxpdCgnLCcpLm1hcChpID0+IHBhcnNlSW50KGkpIC8gMjU1KVxuICAgIGxldCBmb250TmFtZSA9IHV1aWQoKVxuICAgIGlmIChmb250TGlzdCkge1xuICAgICAgICBjb25zdCBmb250RXhpc3QgPSBmb250TGlzdC5saXN0IS5maWx0ZXIoZm9udCA9PiBmb250LmZGYW1pbHkgPT0gZm9udEZhbWlseSAmJiBmb250LmZTdHlsZSA9PSBmb250U3R5bGUgJiYgZm9udC5mV2VpZ2h0ID09IGZvbnRXZWlnaHQpXG4gICAgICAgIGlmIChmb250RXhpc3QubGVuZ3RoKVxuICAgICAgICAgICAgZm9udE5hbWUgPSBmb250RXhpc3RbMF0uZk5hbWUhXG4gICAgfVxuICAgIGNvbnN0IHRleHREYXRhOiBUZXh0RGF0YSA9IHtcbiAgICAgICAgZDoge1xuICAgICAgICAgICAgazogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdDogMCxcbiAgICAgICAgICAgICAgICAgICAgczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgczogZm9udFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBmOiBmb250TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHQ6IGRvbS5pbm5lckhUTUwsXG4gICAgICAgICAgICAgICAgICAgICAgICBqOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHI6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBsczogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZjOiBmb250Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAgcDoge30sXG4gICAgICAgIG06IHtcbiAgICAgICAgICAgIGE6IHtcbiAgICAgICAgICAgICAgICBrOiBbXG4gICAgICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgICAgIDBcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGE6IFtdXG4gICAgfVxuICAgIGNvbnN0IGZvbnREZWY6IEZvbnQxID0ge1xuICAgICAgICBmRmFtaWx5OiBmb250RmFtaWx5LFxuICAgICAgICBmV2VpZ2h0OiBgJHtmb250V2VpZ2h0fWAsXG4gICAgICAgIGZTdHlsZTogZm9udFN0eWxlLFxuICAgICAgICBmTmFtZTogZm9udE5hbWVcbiAgICB9XG4gICAgcmV0dXJuIFt0ZXh0RGF0YSwgZm9udERlZl1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckltYWdlKGRvbTogU1ZHSW1hZ2VFbGVtZW50KTogW1JlZmVyZW5jZUlELCBJbWFnZUFzc2V0XSB7XG4gICAgY29uc3QgaWQgPSB1dWlkKClcbiAgICBjb25zdCBkb21IZWlnaHRWYWwgPSBkb20uaGVpZ2h0LmJhc2VWYWxcbiAgICBkb21IZWlnaHRWYWwuY29udmVydFRvU3BlY2lmaWVkVW5pdHMoU1ZHTGVuZ3RoLlNWR19MRU5HVEhUWVBFX1BYKVxuICAgIGNvbnN0IGRvbVdpZHRoVmFsID0gZG9tLndpZHRoLmJhc2VWYWxcbiAgICBkb21XaWR0aFZhbC5jb252ZXJ0VG9TcGVjaWZpZWRVbml0cyhTVkdMZW5ndGguU1ZHX0xFTkdUSFRZUEVfUFgpXG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXG4gICAgY2FudmFzLndpZHRoID0gZG9tV2lkdGhWYWwudmFsdWVJblNwZWNpZmllZFVuaXRzXG4gICAgY2FudmFzLmhlaWdodCA9IGRvbUhlaWdodFZhbC52YWx1ZUluU3BlY2lmaWVkVW5pdHNcbiAgICBjdHghLmRyYXdJbWFnZShkb20sIDAsIDApXG5cbiAgICBjb25zdCBkYXRhVXJsID0gY2FudmFzLnRvRGF0YVVSTCgpXG4gICAgY29uc3QgYXNzZXQgPSB7XG4gICAgICAgIGg6IGRvbUhlaWdodFZhbC52YWx1ZUluU3BlY2lmaWVkVW5pdHMsXG4gICAgICAgIHc6IGRvbVdpZHRoVmFsLnZhbHVlSW5TcGVjaWZpZWRVbml0cyxcbiAgICAgICAgaWQ6IHV1aWQoKSxcbiAgICAgICAgdTogZGF0YVVybCxcbiAgICAgICAgZTogMVxuICAgIH1cbiAgICByZXR1cm4gW2lkLCBhc3NldF1cbn0iXX0=